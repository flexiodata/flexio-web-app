{
    "eid_type": "PIP",
    "name": "example-save-data-to-local-storage",
    "short_description": "Example: Save Data to Local Storage",
    "description": "Aggregate, de-duplicate and save recent stories from Hacker News to local storage",
    "task": {
      "op": "sequence",
      "items": [
        {
          "op": "execute",
          "lang": "python",
          "code": "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBjb2xsZWN0aW9ucwppbXBvcnQgcGFuZGFzCmltcG9ydCBpbwoKIyBoYW5kbGVyIHRvIGNvbW11bmljYXRlIHdpdGggRmxleC5pbyBjYWxsaW5nIGNvbnRleHQKZGVmIGZsZXhpb19oYW5kbGVyKGNvbnRleHQpOgoKICAgICMgdGVtcG9yYXJ5IGZpbGUgd2hlcmUgc3RvcmllcyB3aWxsIGJlIHN0b3JlZAogICAgdG1wX2ZpbGUgPSAnZmxleDovZXhhbXBsZXMvZXhhbXBsZS1zYXZlLWRhdGEtdG8tbG9jYWwtc3RvcmFnZS50eHQnCiAgCiAgICAjIGNsZWFyIG91dCBvbGQgc3RvcmllcyBpZiBkZXNpcmVkCiAgICAjIGNvbnRleHQuZnMud3JpdGUodG1wX2ZpbGUsImlkLHRpdGxlLGJ5LHVybCx0aW1lXG4iKSAgCiAgCiAgICAjIGdldCBsYXN0IGZldyBzdG9yaWVzIGZyb20gSGFja2VyIE5ld3MgKGh0dHBzOi8vZ2l0aHViLmNvbS9IYWNrZXJOZXdzL0FQSSkKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2hhY2tlci1uZXdzLmZpcmViYXNlaW8uY29tL3YwL25ld3N0b3JpZXMuanNvbiIpCiAgICBzdG9yaWVzID0gcmVzcG9uc2UuanNvbigpWzo0XQogICAgCiAgICAjIGdldCBuZXcgc3RvcnkgaW5mbwogICAgbmV3X3N0b3JpZXMgPSBbXQogICAgZm9yIGkgaW4gc3RvcmllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9oYWNrZXItbmV3cy5maXJlYmFzZWlvLmNvbS92MC9pdGVtLyIgKyBzdHIoaSkgKyAiLmpzb24iKQogICAgICAgIHN0b3J5ID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgaWYgKHN0b3J5IGlzIG5vdCBOb25lKToKICAgICAgICAgICAgaXRlbSA9IGNvbGxlY3Rpb25zLk9yZGVyZWREaWN0KCkKICAgICAgICAgICAgaXRlbVsnaWQnXSA9IHN0b3J5LmdldCgnaWQnLCcnKQogICAgICAgICAgICBpdGVtWyd0aXRsZSddID0gc3RvcnkuZ2V0KCd0aXRsZScsJycpCiAgICAgICAgICAgIGl0ZW1bJ2J5J10gPSBzdG9yeS5nZXQoJ2J5JywnJykKICAgICAgICAgICAgaXRlbVsndXJsJ10gPSBzdG9yeS5nZXQoJ3VybCcsJycpCiAgICAgICAgICAgIGl0ZW1bJ3RpbWUnXSA9IHN0b3J5LmdldCgndGltZScsJycpCiAgICAgICAgICAgIG5ld19zdG9yaWVzLmFwcGVuZChpdGVtKQoKICAgICMgY3JlYXRlIGEgZGF0YWZyYW1lIGZvciB0aGUgbmV3IHN0b3JpZXMKICAgIGRmID0gcGFuZGFzLkRhdGFGcmFtZShuZXdfc3RvcmllcykKICAgIG5ld19zdG9yeV9idWZmZXIgPSBkZi50b19jc3YoaW5kZXg9RmFsc2UsaGVhZGVyPUZhbHNlKS5lbmNvZGUoKSAgICAKICAgICAgICAKICAgICMgYWdncmVnYXRlIHRoZSBsYXRlc3QgbmV3IGFuZCBwcmV2aW91cyBuZXdzCiAgICAjIGdldCB0aGUgdGVtcCBmaWxlIHdoZXJlIHdlIHN0b3JlZCB0aGUgcmVzdWx0czsgY3JlYXRlIHRoZSBmaWxlIGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgIHRtcF9maWxlX2V4aXN0cyA9IGNvbnRleHQuZnMuZXhpc3RzKHRtcF9maWxlKQogICAgaWYgKHRtcF9maWxlX2V4aXN0cyBpcyBGYWxzZSk6CiAgICAgICAgY29udGV4dC5mcy53cml0ZSh0bXBfZmlsZSwiaWQsdGl0bGUsYnksdXJsLHRpbWVcbiIpCiAgICBvbGRfc3RvcnlfYnVmZmVyID0gY29udGV4dC5mcy5yZWFkKHRtcF9maWxlKSAgICAKICAgIGNvbWJpbmVkX3N0b3J5X2J1ZmZlciA9IG9sZF9zdG9yeV9idWZmZXIgKyBuZXdfc3RvcnlfYnVmZmVyCiAgIAogICAgIyByZW1vdmUgZHVwbGljYXRlcyBhbmQgd3JpdGUgb3V0IHRoZSBuZXcgcmVzdWx0cwogICAgZGYgPSBwYW5kYXMucmVhZF9jc3YoaW8uU3RyaW5nSU8oY29tYmluZWRfc3RvcnlfYnVmZmVyLmRlY29kZSgndXRmLTgnKSkpCiAgICBkZiA9IGRmLmRyb3BfZHVwbGljYXRlcygpCiAgICByZXN1bHQgPSBkZi50b19jc3YoaW5kZXg9RmFsc2UpLmVuY29kZSgpCiAgICBjb250ZXh0LmZzLndyaXRlKHRtcF9maWxlLHJlc3VsdCkgICAgCiAgICAKICAgICMgZWNobyB0aGUgcmVzdWx0cwogICAgY29udGV4dC5vdXRwdXQud3JpdGUocmVzdWx0KQogICAgcmV0dXJuICAgIAoK"
        },
        {
          "op": "convert",
          "input": {
            "format": "csv"
          },
          "output": {
            "format": "table"
          }
        }
      ]
    }
  }
