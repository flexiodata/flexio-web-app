{
    "eid_type": "PIP",
    "name": "example-currency-rates",
    "title": "Currency Rates",
    "description": "Lists the currency exchange rates for a particular currency and date",
    "deploy_mode": "R",
    "deploy_api": "A",
    "deploy_schedule": "I",
    "deploy_email": "I",
    "deploy_ui": "I",
    "examples": [
        "\"USD\"",
        "\"EUR\", \"2018-12-31\"",
        "A1, B1"
    ],
    "params": [
        {
            "name": "cur",
            "type": "string",
            "description": "The currency type to use as the base",
            "required": true
        },
        {
            "name": "date",
            "type": "date",
            "description": "The exchange rate date in YYYY-DD-MM format",
            "required": false
        }
    ],
    "notes": "This function uses the https://exchangeratesapi.io API to list the rates.\n\nThe following currency types are allowed: CAD, HKD, ISK, PHP, DKK, HUF, CZK, GBP, RON, SEK, IDR, INR, BRL, RUB, HRK, JPY, THB, CHF, EUR, MYR, BGN, TRY, CNY, NOK, NZD, ZAR, USD, MXN, SGD, AUD, ILS, KRW, PLN",
    "task": {
        "op": "sequence",
        "items": [
            {
                "op": "execute",
                "lang": "python",
                "code": "CiMgLS0tCiMgbmFtZTogY3VycmVuY3ktcmF0ZXMKIyBkZXBsb3llZDogdHJ1ZQojIHRpdGxlOiBDdXJyZW5jeSBSYXRlcwojIGRlc2NyaXB0aW9uOiBMaXN0cyB0aGUgY3VycmVuY3kgZXhjaGFuZ2UgcmF0ZXMgZm9yIGEgcGFydGljdWxhciBjdXJyZW5jeSBhbmQgZGF0ZQojIHBhcmFtczoKIyAtIG5hbWU6IGN1cgojICAgdHlwZTogc3RyaW5nCiMgICBkZXNjcmlwdGlvbjogVGhlIGN1cnJlbmN5IHR5cGUgdG8gdXNlIGFzIHRoZSBiYXNlCiMgICByZXF1aXJlZDogdHJ1ZQojIC0gbmFtZTogZGF0ZQojICAgdHlwZTogZGF0ZQojICAgZGVzY3JpcHRpb246IFRoZSBleGNoYW5nZSByYXRlIGRhdGUgaW4gWVlZWS1ERC1NTSBmb3JtYXQKIyAgIHJlcXVpcmVkOiBmYWxzZQojIGV4YW1wbGVzOgojIC0gJyJVU0QiJwojIC0gJyJFVVIiLCAiMjAxOC0xMi0zMSInCiMgLSAnQTEsIEIxJwojIG5vdGVzOiB8LQojICAgVGhpcyBmdW5jdGlvbiB1c2VzIHRoZSBodHRwczovL2V4Y2hhbmdlcmF0ZXNhcGkuaW8gQVBJIHRvIGxpc3QgdGhlIHJhdGVzLgojCiMgICBUaGUgZm9sbG93aW5nIGN1cnJlbmN5IHR5cGVzIGFyZSBhbGxvd2VkOiBDQUQsIEhLRCwgSVNLLCBQSFAsIERLSywgSFVGLCBDWkssIEdCUCwgUk9OLCBTRUssIElEUiwgSU5SLCBCUkwsIFJVQiwgSFJLLCBKUFksIFRIQiwgQ0hGLCBFVVIsIE1ZUiwgQkdOLCBUUlksIENOWSwgTk9LLCBOWkQsIFpBUiwgVVNELCBNWE4sIFNHRCwgQVVELCBJTFMsIEtSVywgUExOCiMgLS0tCgoKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmZyb20gZGF0ZXRpbWUgaW1wb3J0ICoKZnJvbSBjZXJiZXJ1cyBpbXBvcnQgVmFsaWRhdG9yCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IE9yZGVyZWREaWN0CmZyb20gb3BlcmF0b3IgaW1wb3J0IGl0ZW1nZXR0ZXIKCiMgbWFpbiBmdW5jdGlvbiBlbnRyeSBwb2ludApkZWYgZmxleGlvX2hhbmRsZXIoZmxleCk6CgogICAgIyBnZXQgdGhlIGlucHV0CiAgICBpbnB1dCA9IGZsZXguaW5wdXQucmVhZCgpCiAgICB0cnk6CiAgICAgICAgaW5wdXQgPSBqc29uLmxvYWRzKGlucHV0KQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGlucHV0LCBsaXN0KTogcmFpc2UgVmFsdWVFcnJvcgogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcgoKICAgICMgZGVmaW5lIHRoZSBleHBlY3RlZCBwYXJhbWV0ZXJzIGFuZCBtYXAgdGhlIHZhbHVlcyB0byB0aGUgcGFyYW1ldGVyIG5hbWVzCiAgICAjIGJhc2VkIG9uIHRoZSBwb3NpdGlvbnMgb2YgdGhlIGtleXMvdmFsdWVzCiAgICBwYXJhbXMgPSBPcmRlcmVkRGljdCgpCiAgICBwYXJhbXNbJ2N1ciddID0geydyZXF1aXJlZCc6IFRydWUsICd2YWxpZGF0b3InOiB2YWxpZGF0ZV9jdXJyZW5jeSwgJ2NvZXJjZSc6IGxhbWJkYSBzOiBzLnVwcGVyKCl9CiAgICBwYXJhbXNbJ2RhdGUnXSA9IHsncmVxdWlyZWQnOiBGYWxzZSwgJ3R5cGUnOiAnZGF0ZScsICdjb2VyY2UnOiBsYW1iZGEgczogZGF0ZXRpbWUuc3RycHRpbWUocywgJyVZLSVtLSVkJyl9CiAgICBpbnB1dCA9IGRpY3QoemlwKHBhcmFtcy5rZXlzKCksIGlucHV0KSkKCiAgICAjIHZhbGlkYXRlIHRoZSBtYXBwZWQgaW5wdXQgYWdhaW5zdCB0aGUgdmFsaWRhdG9yCiAgICAjIGlmIHRoZSBpbnB1dCBpcyB2YWxpZCByZXR1cm4gYW4gZXJyb3IKICAgIHYgPSBWYWxpZGF0b3IocGFyYW1zLCBhbGxvd191bmtub3duID0gVHJ1ZSkKICAgIGlucHV0ID0gdi52YWxpZGF0ZWQoaW5wdXQpCiAgICBpZiBpbnB1dCBpcyBOb25lOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IKCiAgICB0cnk6CgogICAgICAgIGRhdGUgPSAnbGF0ZXN0JzsKICAgICAgICBpZiAnZGF0ZScgaW4gaW5wdXQua2V5cygpOgogICAgICAgICAgICBkYXRlID0gaW5wdXRbJ2RhdGUnXS5zdHJmdGltZSgnJVktJW0tJWQnKQoKICAgICAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuZXhjaGFuZ2VyYXRlc2FwaS5pby8nK2RhdGUrJz9iYXNlPScgKyBpbnB1dFsnY3VyJ10KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwpCiAgICAgICAgcmF0ZXMgPSByZXNwb25zZS5qc29uKClbJ3JhdGVzJ10KCiAgICAgICAgaXRlbXMgPSBsaXN0KCkKICAgICAgICBmb3IgY3VycmVuY3ksIGFtb3VudCBpbiByYXRlcy5pdGVtcygpOgogICAgICAgICAgICBpdGVtcy5hcHBlbmQoW2N1cnJlbmN5LCBhbW91bnRdKQogICAgICAgIGl0ZW1zID0gc29ydGVkKGl0ZW1zLCBrZXk9aXRlbWdldHRlcigwKSkKCiAgICAgICAgcmVzdWx0ID0gW1snY3VycmVuY3knLCdhbW91bnQnXV0KICAgICAgICByZXN1bHQuZXh0ZW5kKGl0ZW1zKQoKICAgICAgICBmbGV4Lm91dHB1dC5jb250ZW50X3R5cGUgPSAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICBmbGV4Lm91dHB1dC53cml0ZShyZXN1bHQpCgogICAgZXhjZXB0OgogICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcgoKCmRlZiB2YWxpZGF0ZV9jdXJyZW5jeShmaWVsZCwgdmFsdWUsIGVycm9yKToKCiAgICBjdXJyZW5jeV90eXBlcyA9IFsKICAgICAgICAnQ0FEJywnSEtEJywnSVNLJywnUEhQJywnREtLJywnSFVGJywnQ1pLJywnR0JQJywnUk9OJywnU0VLJywKICAgICAgICAnSURSJywnSU5SJywnQlJMJywnUlVCJywnSFJLJywnSlBZJywnVEhCJywnQ0hGJywnRVVSJywnTVlSJywKICAgICAgICAnQkdOJywnVFJZJywnQ05ZJywnTk9LJywnTlpEJywnWkFSJywnVVNEJywnTVhOJywnU0dEJywnQVVEJywKICAgICAgICAnSUxTJywnS1JXJywnUExOJwogICAgXQogICAgaWYgYW55KHZhbHVlIGluIGMgZm9yIGMgaW4gY3VycmVuY3lfdHlwZXMpOgogICAgICAgIHJldHVybgoKICAgIGVycm9yKGZpZWxkLCAnaXMgYW4gaW52YWxpZCBjdXJyZW5jeSB0eXBlJyk="
            }
        ]
    }
}
