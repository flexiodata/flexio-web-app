(function(c,b,a,d){(function(n,p,u){var w=n([]),s=n.resize=n.extend(n.resize,{}),o,l="setTimeout",m="resize",t=m+"-special-event",v="delay",r="throttleWindow";s[v]=250;s[r]=true;n.event.special[m]={setup:function(){if(!s[r]&&this[l]){return false}var e=n(this);w=w.add(e);n.data(this,t,{w:e.width(),h:e.height()});if(w.length===1){q()}},teardown:function(){if(!s[r]&&this[l]){return false}var e=n(this);w=w.not(e);e.removeData(t);if(!w.length){clearTimeout(o)}},add:function(f){if(!s[r]&&this[l]){return false}var g;function e(h,x,k){var j=n(this),i=n.data(this,t);i.w=x!==u?x:j.width();i.h=k!==u?k:j.height();g.apply(this,arguments)}if(n.isFunction(f)){g=f;return e}else{g=f.handler;f.handler=e}}};function q(){o=p[l](function(){w.each(function(){var h=n(this),e=h.width(),f=h.height(),g=n.data(this,t);if(e!==g.w||f!==g.h){h.trigger(m,[g.w=e,g.h=f])}});q()},s[v])}})(jQuery,this);c.fn.adjacentUntil=function(e){var g=c(this),f;f=g.nextAll(e);if(f.length>0){return g.nextUntil(f)}f=g.prevAll(e);if(f.length>0){return g.prevUntil(f)}return c()};c.biggrid=function(ab,y){var h=(Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)).substring(0,16),aa="biggrid-"+h;var s=this,ac=ab,Q=c(ac),af=c(a),P=c("html"),ag=c(),U=c(),G=c(),L=c(),R=c(),E=c(),Y=c(),g=c(),n=c(),N=c(),I=c(),k=c(),z=c(),r=c(),f=d,o=d,u=[],x=0,p=false,M=d,v=d,F=d,B=d,l=d,q=d,m=d,t=d,O=d,Z=true,e=false,V=d,j=d,H=d,J=d,A=d,w=d,T=d,S=d,X=d,W=d,ae=d,ad=d,i=4,D=80,K=b.screen.height,C=this.options=c.extend({},c.biggrid.defaults,y);s.init=function(){var ah=Q.data("biggrid");if(ah!==d){Q.removeData("biggrid")}Q.data("biggrid",s);s.setFullscreen(C.fullscreen===true?true:false);if(c.isArray(C.columns)){u=C.columns;s.render();s.initEvents()}else{c.getJSON(C.columns,function(ai){u=ai.columns;s.render();s.initEvents()})}return s};s.initEvents=function(){L.on("scroll",s.onGridBodyScroll);L.on("resize",s.onGridBodyResize);ag.on("mousemove","th",s.onMouseMove);ag.on("mousedown","th",s.onGridHeaderCellMouseDown);ag.on("click","th",s.onGridHeaderCellClick);ag.on("dblclick","th",s.onGridHeaderCellDoubleClick);Q.on("mouseenter","th, td",s.onGridCellMouseEnter);Q.on("click",".biggrid-cell-dropdown .dropdown-toggle",s.onGridCellDropdownButtonClick);Q.on("click",".biggrid-cell-dropdown .dropdown-menu a",s.onGridCellDropdownMenuItemClick);Q.on("mousemove",".biggrid-cell-dropdown",s.onGridCellDropdownMouseMove);Q.on("click",".btn-toggle-fullscreen",s.onToggleFullscreenButtonClick);Q.on("click",s.onGridClick);af.on("mousemove",s.onMouseMove);af.on("mousedown",s.onDocumentMouseDown);af.on("mouseup",s.onDocumentMouseUp);return s};s.onGridBodyScroll=function(ap){clearTimeout(j);ag.css("left",(-1*this.scrollLeft)-1);if(A===true){L.data("biggridscrollbars").update()}M=Math.floor(this.scrollTop/O);v=Math.ceil((this.scrollTop+this.clientHeight)/O);s.updateRowCountText();var al;if(t===d&&p===true){al=x}else{al=t}var ak=Math.max(v-(C.limit/5),0);var an=ak;if(ak>al-C.limit){ak=al-C.limit}if(an>al-m){an=al-m}var am=ak*O,ao=an*O;if(t===d){var aq=m*O;if(ao+aq<=I.height()){g.css("top",ao+"px")}}else{g.css("top",ao+"px")}var aj=F+(C.limit*C.loadingThreshold),ah=false;if(M<F){ah=true}if(t!==d&&v>aj&&B<t){ah=true}if(t===d&&v>aj){ah=true}if(ah){renderRowsInternal=function(){s.renderRows({start:ak,limit:C.limit,callback:function(ar){E.css("top",am+"px")}})};var ai=C.loadingScrollTimer;if(c.isArray(C.rows)){renderRowsInternal()}else{j=setTimeout(renderRowsInternal,ai)}}};s.onGridBodyResize=function(ah){M=Math.floor(this.scrollTop/O);v=Math.ceil((this.scrollTop+this.clientHeight)/O);s.updateRowCountText()};s.onGridHeaderCellMouseDown=function(ah){X=ah.pageX;W=ah.pageY;var aj=s.getActionObject(this,ah.type);if(aj.type==="col-resize"){if(aj.position==="cell-left"){var ai=c(this).prev("th").data("cls");k=Q.find("th."+ai)}if(aj.position==="cell-right"){var ai=c(this).data("cls");k=Q.find("th."+ai)}}};s.onGridCellDropdownMouseMove=function(ah){T=ah.pageX;S=ah.pageY;ah.stopPropagation()};s.onGridHeaderCellClick=function(ah){if(Q.hasClass("biggrid-state-allow-selection")){var al=s.getActionObject(this,ah.type);if(al.type!=="col-select"){ah.stopPropagation();return}var an=c(this),ak=an.data("cls"),am="";if(an.hasClass(C.colInvalidCls)){return}if(ah.shiftKey){if(z.length==0){z=an}else{var aj=z.last(),ai=aj.adjacentUntil("th."+ak);z=z.add(ai);z=z.add(an)}}else{if(ah.metaKey){z=z.add(an)}else{z=an}}c.each(z,function(ao,ap){ak=c(ap).data("cls");am+="."+aa+" td."+ak+", "});am=am.slice(0,-2);am+=" { background-color: "+C.selectionColor+" !important; }";s.updateStyle("col-selection",am)}ah.stopPropagation()};s.onGridHeaderCellDoubleClick=function(ah){var aj=s.getActionObject(this,ah.type);if(aj.type!=="col-auto-resize"){ah.stopPropagation();return}if(aj.position==="cell-left"){var ai=c(this).prev("th").data("cls");k=Q.find("th."+ai)}if(aj.position==="cell-right"){var ai=c(this).data("cls");k=Q.find("th."+ai)}s.autoResizeColumn()};s.onGridCellMouseEnter=function(ah){if(!r.hasClass("open")){s.moveCellOptionsButton(this)}};s.onGridCellDropdownButtonClick=function(ah){var ai=c(this);var ak="";if(l===d&&q===d){ak="disabled"}var aj='<li><a href="#" action="sort-asc"><i18n>Sort Ascending</i18n></a></li><li><a href="#" action="sort-desc"><i18n>Sort Descending</i18n></a></li><li class="divider"></li>';var ak="";if(l===d&&q===d){ak="disabled"}aj+='<li class="'+ak+'"><a href="#" action="remove-sort-filter"><i18n>Remove Sort</i18n></a></li>';ai.closest(".biggrid-cell-dropdown").find(".dropdown-menu").empty().append(aj);ai.dropdown("toggle").off("click.dropdown.data-api");ah.preventDefault()};s.onGridCellDropdownMenuItemClick=function(ai){var ak=c(this),am=ak.attr("action"),ah=r.data("cell"),al=c(ah),aj=al.data("name");r.hide();if(am==="sort-asc"){s.renderRows({start:0,sort:aj+" ASC"})}if(am==="sort-desc"){s.renderRows({start:0,sort:aj+" DESC"})}if(am==="remove-sort-filter"){s.renderRows({start:0,sort:"",filter:""})}ai.preventDefault()};s.onToggleFullscreenButtonClick=function(ah){var ai=Q.hasClass("biggrid-state-fullscreen");s.setFullscreen(!ai);ah.preventDefault()};s.onGridClick=function(ah){if(Q.hasClass("biggrid-state-allow-selection")){s.updateStyle("col-selection","");z=c()}};s.onMouseMove=function(ah){T=ah.pageX;S=ah.pageY;if(k.length>0){r.hide();s.updateCursor("ew-resize");s.resizeColumn();if(A===true){L.data("biggridscrollbars").update()}return}if(this.tagName==="TH"){var ai=s.getActionObject(this,ah.type);if(ai.type==="mouse-move"){if(!r.hasClass("open")){r.show();s.moveCellOptionsButton(this)}if(ai.position==="cell-center"){s.updateCursor("")}else{s.updateCursor("ew-resize")}}ah.stopPropagation()}else{if(!r.hasClass("open")){r.hide()}s.updateCursor("")}};s.onDocumentMouseDown=function(ah){X=ah.pageX;W=ah.pageY};s.onDocumentMouseUp=function(ah){ae=ah.pageX;ad=ah.pageY;s.updateCursor("");k=c();X=d;W=d};s.getActionObject=function(aj,am){var al=L.get(0).scrollLeft,ao=aj.offsetLeft,ai=aj.clientWidth,ah=C.colResizeThreshold;var an=T+al-w.left;var ak={x:an,y:S,type:d,position:d};if(an>ao+ah&&an<ao+ai-ah){ak.position="cell-center"}else{if(an<=ao+ah){ak.position="cell-left"}else{if(an>=ao+ai-ah){ak.position="cell-right"}}}if(am==="mousemove"){ak.type="mouse-move"}if(am==="mousedown"){if(ak.position==="cell-left"||ak.position==="cell-right"){ak.type="col-resize"}}if(am==="click"){if(ak.position==="cell-center"){ak.type="col-select"}}if(am==="dblclick"){if(ak.position==="cell-left"||ak.position==="cell-right"){ak.type="col-auto-resize"}}if(aj.getAttribute("data-cls")===C.colInvalidCls){ak.type="none"}return ak};s.calcRowHeight=function(){var ah=c("<tr><td>&nbsp;</td></tr>").appendTo(Y),ai=ah.find("td");O=ai.outerHeight(true);ah.remove();return s};s.setCustomScrollbars=function(ah){if(ah===true){if(L.data("biggridscrollbars")===d){L.biggridscrollbars()}A=true}else{if(L.data("biggridscrollbars")!==d){L.data("biggridscrollbars").destroy()}A=false}};s.setFullscreen=function(ah){if(ah===true){Q.addClass("biggrid-state-fullscreen");P.addClass("biggrid-state-fullscreen");if(C.customScrollbars===true&&C.customScrollbarsFullscreen!==true){s.setCustomScrollbars(false)}}else{Q.removeClass("biggrid-state-fullscreen");P.removeClass("biggrid-state-fullscreen");if(C.customScrollbars===true){s.setCustomScrollbars(true)}}if(L.length>0){ag.css("left",(-1*(L.get(0)).scrollLeft)-1)}w=Q.offset();return s};s.setStripedRowsVisible=function(ah){if(ah===true){Q.addClass("biggrid-state-show-striped-rows")}else{Q.removeClass("biggrid-state-show-striped-rows")}return s};s.setVerticalLinesVisible=function(ah){if(ah===true){Q.addClass("biggrid-state-show-vert-lines")}else{Q.removeClass("biggrid-state-show-vert-lines")}return s};s.setHorizontalLinesVisible=function(ah){if(ah===true){Q.addClass("biggrid-state-show-horz-lines")}else{Q.removeClass("biggrid-state-show-horz-lines")}return s};s.setToolbarVisible=function(ah){if(ah===true){Q.addClass("biggrid-state-show-toolbar")}else{Q.removeClass("biggrid-state-show-toolbar")}return s};s.setAllowSelection=function(ah){if(ah===true){Q.addClass("biggrid-state-allow-selection")}else{Q.removeClass("biggrid-state-allow-selection")}return s};s.setCellWrap=function(ah){if(ah===true){Q.addClass("biggrid-state-wrap-cells")}else{Q.removeClass("biggrid-state-wrap-cells")}return s};s.resizeColumn=function(ah){var ai=k.first(),ak=ai.offset(),aj=Math.floor(ak.left);if(ah===d){ah=T-aj}ah-=parseInt(""+ai.css("padding-left"));ah-=parseInt(""+ai.css("padding-right"));if(ah<C.colMinWidth){ah=C.colMinWidth}if(ah>C.colMaxWidth){ah=C.colMaxWidth}k.css({"min-width":ah,"max-width":ah});return s};s.autoResizeColumn=function(){var ai=k.first(),aj=ai.data("cls"),ak="";k.css({"min-width":"auto","max-width":C.colMaxWidth,width:"auto"});ak="."+aa+" td."+aj+" { min-width: auto; max-width: "+C.colMaxWidth+"px; width: auto; }";s.updateStyle(aj,ak);var ah=0;k.each(function(){ah=Math.max(ah,c(this).innerWidth())});s.updateStyle(aj,"");s.resizeColumn(ah);s.updateCursor("");k=c();return s};s.updateCursor=function(ai){if(H===ai){return}if(ai===""){s.updateStyle("cursor","");H=""}var ah="."+aa+" td, ."+aa+" th { cursor: "+ai+"; }\n";s.updateStyle("cursor",ah);H=ai};s.updateStyle=function(ah,ai){if(ai===d||ai.length==0){c("#"+aa+"-"+ah).remove();return}var aj='<style id="'+aa+"-"+ah+'" type="text/css">'+ai+"</style>";c("#"+aa+"-"+ah).remove();c(aj).appendTo("head");return s};s.updateRowCountText=function(){var ah="Showing rows "+(M+1)+" - ";if(t===d){ah+=v}else{ah+=Math.min(v,t)+" of "+t}G.html(ah);return s};s.updateGridBodyHeight=function(){if(t===d){var ah=(x*O);I.css("height",ah+"px")}else{var ah=(t*O)+C.rowInvalidHeight;I.css("height",ah+"px")}};s.moveCellOptionsButton=function(ap){if(ap===r.data("cell")){return}var am=L.get(0).scrollLeft,an=ap.offsetTop,ai=ap.offsetLeft,ao=ap.clientWidth,aj=ap.clientHeight,al=f,ah=o,ak=C.colResizeThreshold;r.data("cell",ap).removeClass("open").css({top:J+an+((aj-ah)/2),left:ai+ao-al-(ak*2)-am})};s.render=function(){Q.addClass("biggrid "+aa).empty().append(C.template);N=Q.find(".biggrid-toolbar");U=N.find(".biggrid-title");G=N.find(".biggrid-row-count");ag=Q.find(".biggrid-header");R=Q.find(".biggrid-body-wrapper");L=R.find(".biggrid-body");E=L.find(".table-grid-data");Y=E.find("tbody");g=L.find(".table-grid-faux");r=Q.find(".biggrid-cell-dropdown");I=Q.find(".biggrid-yardstick");U.html(C.title);var ah=r[0];f=ah.clientWidth;o=ah.clientHeight;r.hide();J=N.outerHeight(true);s.calcRowHeight();s.setCustomScrollbars(C.customScrollbars===true?true:false);s.setFullscreen(C.fullscreen===true?true:false);s.setStripedRowsVisible(C.showStripedRows===true?true:false);s.setVerticalLinesVisible(C.showVerticalLines===true?true:false);s.setHorizontalLinesVisible(C.showHorizontalLines===true?true:false);s.setToolbarVisible(C.showToolbar===true?true:false);s.setAllowSelection(C.allowSelection===true?true:false);s.setCellWrap(C.wrapCells===true?true:false);s.renderHead();if(C.autoLoad){s.renderRows()}return s};s.renderHead=function(){var ai="",ah="";col_idx=0,col_cls="";ai+="<tr>";c.each(u,function(aj,ak){var al="left";col_cls=C.colClsPrefix+col_idx;ai+='<th class="'+col_cls+'" data-cls="'+col_cls+'" data-name="'+ak.name+'" data-type="'+ak.type+'" data-width="'+ak.width+'" data-scale="'+ak.scale+'" data-expr="'+ak.expression+'" style="min-width: '+C.colDefaultWidth+"px; max-width: "+C.colDefaultWidth+'px; text-align: center;"><div class="cell-inner">'+ak.name+"</div></th>";if(ak.type=="date"){al="center"}if(ak.type=="numeric"){al="right"}ah+="."+aa+" td."+col_cls+" { min-width: 0; max-width: 0; text-align: "+al+"; }\n";col_idx++});col_cls=C.colInvalidCls;ai+='<th class="'+col_cls+'" data-cls="'+col_cls+'">&nbsp;</th>';ai+="</tr>";ah+="."+aa+" th."+col_cls+" { min-width: "+C.colInvalidWidth+"px; width: 100%; }\n";s.updateStyle("base",ah);Q.find("thead").empty().append(ai);return s};s.renderRows=function(ao){ao=c.extend({},ao);var an=ao.start||C.start,ah=ao.limit||C.limit,ai=ao.sort||l,aj=ao.filter||q,am=ao.callback;if(ao.sort===""){ai=d}if(ao.filter===""){aj=d}e=true;n.remove();if(Z===true||ai!==l||aj!==q){n=c(C.loadingBigTemplate).appendTo(Q)}else{n=c(C.loadingTemplate).appendTo(Q)}function ak(aw){var ar=0,au=0,av="",ap="",aq="";m=Math.ceil(K*2/O);c.each(aw,function(ax,ay){au=0;ap+="<tr>";if(Z===true&&ar<m){aq+="<tr>"}c.each(ay,function(az,aA){av=C.colClsPrefix+au;ap+='<td class="'+av+'" data-cls="'+av+'">'+aA+"</td>";if(Z===true&&ar<m){aq+='<td class="'+av+'" data-cls="'+av+'">&nbsp;</td>'}au++});av=C.colInvalidCls;ap+='<td class="'+av+'" data-cls="'+av+'">&nbsp;</td>';if(Z===true&&ar<m){aq+='<td class="'+av+'" data-cls="'+av+'">&nbsp;</td>'}ap+="</tr>";if(Z===true&&ar<m){aq+="</tr>"}ar++});Y.empty().append(ap);n.remove();if(Z===true){L.find(".table-grid-faux tbody").append(aq)}if(Z===true){L.scrollTop(1);L.scrollTop(0);L.scrollLeft(1);L.scrollLeft(0)}else{if(ai!==l||aj!==q){L.scrollTop(1);L.scrollTop(0);E.css("top","0px")}}if(A===true){L.data("biggridscrollbars").update()}F=an;B=an+ar;l=ai;q=aj;x=Math.max(x,B);if(Z===true){s.updateGridBodyHeight()}Z=false;e=false;if(t===d){if(ar<ah){t=x;p=true}s.updateGridBodyHeight()}if(am!==d){var at={start:F,end:B,sort:l,filter:q};am(at)}}if(c.isArray(C.rows)){t=C.rows.length;ak(C.rows.slice(an,an+ah))}else{if(V&&V.readyState!=4){n.remove();V.abort()}var al=C.rows+"?"+C.queryStringStartKey+"="+an+"&"+C.queryStringLimitKey+"="+ah;if(ai!==d){al+="&"+C.queryStringSortKey+"="+ai}if(aj!==d){al+="&"+C.queryStringFilterKey+"="+aj}V=c.getJSON(al,function(ap){var aq=ap.total_count;t=aq?parseFloat(""+aq):d;ak(ap.rows)})}return s};s.init()};c.biggrid.defaults={title:"",fullscreen:false,showStripedRows:true,showVerticalLines:true,showHorizontalLines:false,showToolbar:false,allowSelection:true,wrapCells:false,autoLoad:true,customScrollbars:true,customScrollbarsFullscreen:false,selectionColor:"#ebf6ff",rowInvalidHeight:50,rowClsPrefix:"r",colClsPrefix:"c",colInvalidCls:"cx",colInvalidWidth:200,colMinWidth:20,colMaxWidth:1200,colDefaultWidth:120,colResizeThreshold:3,columns:[],rows:[],queryStringStartKey:"start",queryStringLimitKey:"limit",queryStringSortKey:"order",queryStringFilterKey:"filter",start:0,limit:200,loadingThreshold:0.8,loadingScrollTimer:100,loadingTemplate:'<div class="biggrid-loading"><i18n>Loading...</i18n></div>',loadingBigTemplate:'<div class="biggrid-loading-big"><i18n>Loading...</i18n> <i class="imgx-spinner-24"></i></div><div class="biggrid-backdrop"></div>',template:'<div class="navbar biggrid-toolbar"><div class="navbar-inner"><ul class="nav"><li><p class="navbar-text biggrid-title"></p></li></ul><ul class="nav pull-right"><li><p class="navbar-text biggrid-row-count"></p></li><li><a href="#" class="btn-toggle-fullscreen"><i class="icon-resize-full icon-white"></i><i class="icon-resize-small icon-white"></i></a></li></ul></div></div><div class="biggrid-header"><table class="table"><thead></thead></table></div><div class="biggrid-body-wrapper"><div class="biggrid-body"><table class="table table-grid-data"><thead></thead><tbody></tbody></table><table class="table table-grid-faux"><thead></thead><tbody></tbody></table><div class="biggrid-yardstick"></div></div></div><div class="biggrid-cell-dropdown dropdown"><a href="#" class="dropdown-toggle btn-cell-dropdown" data-toggle="dropdown"><span class="caret"></span></a><ul class="dropdown-menu"></ul></div>'};c.fn.biggrid=function(e){return this.each(function(){(new c.biggrid(this,e))})}})(jQuery,window,document);