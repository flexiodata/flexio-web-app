name: Copy a file directory to cloud storage
description:
id: copy-files-to-cloud-storage
want: I want to copy a file directory to cloud storage

code: >
  Flexio.pipe()
    .list('/{username}-flexio-public-s3')

steps:
  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 1. Access a file directory

      For this example, we're going to copy files from one cloud storage directory into another.  In addition, we'll filter out files that are greater than 50KB in size.

      The first step in the pipe is to access a sample Amazon S3 directory included with your Flex.io account. As you see in the console, we'll use the `list` task to read through each of the files in the directory. Click the Run button to see the files.

  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 2. Add a filter

      Now that we see our files, let's say we only want to move files that are less than 50KB in size. To do this, add a `filter` task like this:

      ```
      Flexio.pipe()
        .list('/{username}-flexio-public-s3')
        .filter('size <= 50000')
      ```

      Re-run the pipe and we'll see that only a handful of files match this criteria.  Now let's transfer these files to a cloud storage account.

  - #----------------------------------------#

    button:
      label: Connect to storage
      action: storage

    blurb: |
      ### Step 3. Create a connection to a cloud storage account

      To copy the files to cloud storage, we first need to set up a connection to Dropbox, Amazon S3, Google Drive, etc.  Click the button below to set up the account.  After connecting, we'll insert the path to the root directory of your account into the code snippet which you can use or modify in the following step.

  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 4. Copy the filtered files to your cloud Storage

      Now we'll copy the files from the S3 account to your cloud storage account. For this, we'll use three tasks in conjunction: `foreach`, `read` and `write` as follows:

      ```
      Flexio.pipe()
        .list('/{username}-flexio-public-s3')
        .filter('size <= 50000')
        .foreach(
          Flexio.pipe()
            .read('/{username}-flexio-public-s3/${item.name}')
            .write('/{connection_alias}/${item.name}')
        )
        .echo('Finished!')
      ```

      **NOTE:** You'll notice that the alias `{connection_alias}` from the connection created in the previous step is referenced in the `write` command. If you want to place the files in a subfolder, simply add a subfolder to the specified path like this: `.write('/{connection_alias}/foo/${item.name}')`.  Now re-run the pipe; then check your cloud storage to see the files that have been added.
