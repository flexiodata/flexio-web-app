name: Process tabular data
description:
id: process-tabular-data
want: I want to process tabular data

code: >
  Flexio.pipe()
    .read('/{username}-flexio-public-s3/contact-list-1.csv')

steps:
  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 1.  Access a CSV file from a directory

      For this example, we're going to get a CSV file from one cloud storage account, do some lightweight processing on it and then send the transformed file to another cloud storage account.

      The first step in the pipe is to access a CSV file from the sample Amazon S3 directory included with your Flex.io account. As you see in the console, we'll use the `read` task to get access to the CSV.  Click the Run button to see the raw CSV data.

  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 2. Add a conversion step

      Now we'll add a simple `convert` task that reformats the data from CSV to a table as follows:

      ```
      Flexio.pipe()
        .read('/{username}-flexio-public-s3/contact-list-1.csv')
        .convert('csv', 'table')
      ```

      Add this task to the code and re-run the pipe; you'll now see the output converted to a tabular format.  Now, let's store this data.

  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 3.  Add a processing step

      For this example, we'll simply add a `select` step to reduce the number of columns in the table. The CSV we are using is a fictitious contact list with 12 fields. Here we'll simply grab the First Name, Last Name and City from the list:

      ```
      Flexio.pipe()
        .read('/{username}-flexio-public-s3/contact-list-1.csv')
        .convert('csv', 'table')
        .select('firstname', 'lastname', 'city')
      ```

      Add the step and re-run the pipe. Now we see only the columns we selected. OK, now let's send this file somewhere.

  - #----------------------------------------#

    button:
      label: Connect to storage
      action: storage

    blurb: |
      ### Step 4. Create a connection to a cloud storage account

      To copy the file to cloud storage, we first need to set up a connection to Dropbox, Amazon S3, Google Drive, etc.  Click the button below to set up the account.  After connecting, we'll insert the path to the root directory of your account into the code snippet which you can use or modify in the following step.

  - #----------------------------------------#

    button:
      label: Next step
      action: next

    blurb: |
      ### Step 5. Transfer the file to your cloud storage

      Now we'll copy the file from the S3 account to your cloud storage account.  You just need to add a `write` task to your code as follows:

      ```
      Flexio.pipe()
        .read('/{username}-flexio-public-s3/contact-list-1.csv')
        .convert('csv', 'table')
        .select('firstname', 'lastname', 'city')
        .write('/{connection_alias}/contact-list-1.csv')
      ```

      **NOTE:** You'll notice that the alias `{connection_alias}` from the connection created in the previous step is referenced in the `write` command. If you want to place the files in a subfolder, simply add a subfolder to the specified path like this: `.write('/{connection_alias}/foo/contact-list-1.csv')`

      Now re-run the pipe; then check your cloud storage to see the files that have been added.
