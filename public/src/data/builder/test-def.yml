name: Internal Analytic Report - Crunchbase
description: >
  Automated feed of integrated and summarized data from Crunchbase News to deliver to internal staff.
keywords: []
connections: []

####

content: |
  # Internal Analytic Report

  ### Key data for Crunchbase News reporting projects

  Automated feed of integrated and summarized data from Crunchbase News to deliver to internal staff.

####

ui:
  settings:
    show_title: false
  prompts:
    - element: message
      title: Internal Analytic Report - Crunchbase
      description: >
        Automated feed of integrated and summarized data from Crunchbase News to deliver to internal staff.

        This template will set up a Google Sheet with live updating results from Crunchbase in two quick steps:
          * Connect to your Google Sheets account
          * Create a Google Sheet with live updating results via Flex.io
      connections:
        - googlesheets
    - element: connection-chooser
      variable: source_connection
      connection_type: googlesheets
      connection_eid: null
    - element: message
      title: Generate Report
      description: >
        You're ready to go! Click the **RUN** button to create the Google Sheet.
      next_button:
        show: true
        label: Run
        actions:
          - create_pipe
          - run_process
    - element: spinner
      spinner_message: Generating sheet...
    - element: summary
      title: Success
      description: >
        ### You're all set!

        Your Google Sheet has successfully been generated. Click the **View Sheet** button to view the sheet.
      action_button:
        label: View Sheet
        href: '{{process_result.spreadsheetUrl}}'

task:
  op: sequence
  items:
    - op: connect
      connection: '${source_connection}'
      alias: gsheets
    - op: execute
      lang: python
      code: >-
        aW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCgpkZWYgZmxleF9oYW5kbGVyKGZsZXgpOgogICAgYXV0aF90b2tlbiA9IGZsZXguY29ubmVjdGlvbnNbImdzaGVldHMiXS5nZXRfYWNjZXNzX3Rva2VuKCkKICAgIHNoZWV0X2lkID0gIjFneU5UX3MzYVdwUm9pSTFvX0JVTk9oVGFyLXR5QzRzdGJOd2h2TEJTRU40IgogICAgdGVtcGxhdGVfdXJsID0gImh0dHBzOi8vZmxleGlvLWNydW5jaGJhc2UtZGVtby5uZXRsaWZ5LmNvbS9hc3NldHMvdGVtcGxhdGVzL2dzaGVldC1jcnVuY2hiYXNlLWludGVybmFsLWFuYWx5dGljLXJlcG9ydC5qc29uIgoKICAgICNzaGVldF9qc29uID0gZ2V0X3NoZWV0KHNoZWV0X2lkLCBhdXRoX3Rva2VuKQogICAgc2hlZXRfanNvbiA9IGNyZWF0ZV9zaGVldCh0ZW1wbGF0ZV91cmwsIGF1dGhfdG9rZW4pCgogICAgIyB0ZXN0IGNvZGUKICAgIGZsZXgub3V0cHV0LmNvbnRlbnRfdHlwZSA9ICJhcHBsaWNhdGlvbi9qc29uIgogICAgZmxleC5vdXRwdXQud3JpdGUoc2hlZXRfanNvbikKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKCmRlZiBnZXRfaHR0cF9oZWFkZXJzKGF1dGhfdG9rZW4pOgogICAgcmV0dXJuIHsgIkF1dGhvcml6YXRpb24iOiAiQmVhcmVyICIgKyBhdXRoX3Rva2VuIH0KCmRlZiBnZXRfc2hlZXQoc2hlZXRfaWQsIGF1dGhfdG9rZW4pOgogICAgdXJsID0gImh0dHBzOi8vc2hlZXRzLmdvb2dsZWFwaXMuY29tL3Y0L3NwcmVhZHNoZWV0cy8iICsgc2hlZXRfaWQKICAgIHBhcmFtcyA9IHsKICAgICAgICAiaW5jbHVkZUdyaWREYXRhIjogVHJ1ZSwKICAgICAgICAicmFuZ2VzIjogWyJBMTpENTEiLCJjYl9zdGRfZnVuY3Rpb25zX3gyeGM4ZDk4XyFBMTpCNiIsImNiX2N1c3RvbV9mdW5jdGlvbnNfYmI4cmtzN2FfIUExOkw0Il0KICAgIH0KICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zLCBoZWFkZXJzPWdldF9odHRwX2hlYWRlcnMoYXV0aF90b2tlbikpCiAgICByZXN1bHQgPSBqc29uLmxvYWRzKHJlc3BvbnNlLnRleHQpCiAgICByZXR1cm4gcmVzdWx0CgpkZWYgY3JlYXRlX3NoZWV0KHRlbXBsYXRlX3VybCwgYXV0aF90b2tlbik6CiAgICB0ZW1wbGF0ZV9yZXNwb25zZSA9IHJlcXVlc3RzLmdldCh0ZW1wbGF0ZV91cmwpCiAgICBkYXRhID0ganNvbi5sb2Fkcyh0ZW1wbGF0ZV9yZXNwb25zZS50ZXh0KQoKICAgIHVybCA9ICJodHRwczovL3NoZWV0cy5nb29nbGVhcGlzLmNvbS92NC9zcHJlYWRzaGVldHMvIgogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1qc29uLmR1bXBzKGRhdGEpLCBoZWFkZXJzPWdldF9odHRwX2hlYWRlcnMoYXV0aF90b2tlbikpCiAgICByZXN1bHQgPSBqc29uLmxvYWRzKHJlc3BvbnNlLnRleHQpCiAgICByZXR1cm4gcmVzdWx0Cg==
