name: PDF to JSON
alias: pdf-to-json
deploy_mode: R
deploy_schedule: I
deploy_email: I
deploy_api: A
deploy_ui: I
task:
  op: sequence
  items:
    - op: execute
      lang: python
      code: >-
        aW1wb3J0IHJlcXVlc3RzCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IE9yZGVyZWREaWN0IAoKZGVmIGZsZXhpb19oYW5kbGVyKGZsZXgpOgoKICAgIHVybCA9IGZsZXgucXVlcnkuZ2V0KCd1cmwnLCcnKQogICAgY29udGVudF90eXBlID0gJycKICAgIGNvbnRlbnQgPSAnJwoKICAgIHRyeToKICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHVybCkKICAgICAgICBjb250ZW50X3R5cGUgPSByLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddCiAgICAgICAgY29udGVudCA9IHIuY29udGVudAogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCiAgICBpZiAoY29udGVudF90eXBlICE9ICdhcHBsaWNhdGlvbi9wZGYnKToKICAgICAgICBlcnJvcl9pbmZvID0gT3JkZXJlZERpY3QoKQogICAgICAgIGVycm9yX2luZm9bJ2Vycm9yJ10gPSBPcmRlcmVkRGljdCgpCiAgICAgICAgZXJyb3JfaW5mb1snZXJyb3InXVsnY29kZSddID0gJ3JlYWQtZmFpbGVkJwogICAgICAgIGVycm9yX2luZm9bJ2Vycm9yJ11bJ21lc3NhZ2UnXSA9ICdUaGUgVVJMIGlzIGVpdGhlciBpbnZhbGlkIG9yIHRoZSBjb250ZW50IGlzIG5vdCBhIHZhbGlkIFBERi4nCiAgICAgICAgCiAgICAgICAgZmxleC5vdXRwdXQuY29udGVudF90eXBlID0gJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgZmxleC5zdGF0dXMoNTAwKSAgICAgICAgCiAgICAgICAgZmxleC5lbmQoZXJyb3JfaW5mbykgICAgICAgIAogICAgCiAgICBmbGV4Lm91dHB1dC5jb250ZW50X3R5cGUgPSBjb250ZW50X3R5cGUKICAgIGZsZXgub3V0cHV0LndyaXRlKGNvbnRlbnQp
    - op: convert
      input:
        format: pdf
        pages: '${query.pages}'
      output:
        format: json
